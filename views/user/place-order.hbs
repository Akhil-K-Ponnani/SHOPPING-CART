<section>
   <h2 class="ml-3 mt-5">Enter Delivery Details</h2>
   <form action="" method="POST" id="checkout-form">
      <div class="row mt-3">
         <div class="col-md-8">
            <div class="container">
            <input type="text" name="user" value="{{user._id}}" hidden>
               <div class="form-group">
                  <label for="address">Address</label>
                  <input type="text" class="form-control" id="address" name="address">
               </div>
               <div class="form-group">
                  <label for="pincode">Pincode</label>
                  <input type="number" class="form-control" id="pincode" name="pincode">
               </div>
               <div class="form-group">
                  <label for="mobile">Mobile</label>
                  <input type="tel" class="form-control" id="mobile" name="mobile">
               </div>
            </div>
         </div>
         <div class="col-md-4">
            <div class="container">
               <div class="mt-5 border border-secondary rounded p-3">
                  <h5>Total Amount : Rs.{{total}}</h5>
                  <hr>
                  <p>Payment Method</p>
                  <label class="radio-online">
                  <input type="radio" name="payment-method" value="COD" checked>COD
                  </label><br>
                  <label class="radio-online" mt-2>
                  <input type="radio" name="payment-method" value="ONLINE">Online Payment
                  </label>
                  <button type="submit" class="btn btn-primary float-right">Checkout</button>
               </div>
            </div>
         </div>
      </div>
   </form>
</section>




<script>
$('#checkout-form').submit((e) => {
   e.preventDefault()
   $.ajax({
      url:'/place-order',
      method:'post',
      data:$('#checkout-form').serialize(),
      success:((response) => {
         alert(response)
         if(response.codSuccess)
         {
            location.href = '/order-success'
         }
         else
         {
            razorpayPayment(response)
         }
      })
   })
   function razorpayPayment(order)
   {
      var options = {
      "key": "rzp_test_o4TqEFcczJ1VzH", // Enter the Key ID generated from the Dashboard
      "amount": order.amount, // Amount is in currency subunits. Default currency is INR. Hence, 50000 refers to 50000 paise
      "currency": "INR",
      "name": "Info Prism",
      "description": "Test Transaction",
      "image": "https://example.com/your_logo",
      "order_id": order.id, //This is a sample Order ID. Pass the `id` obtained in the response of Step 1
      "handler": function (response){
      alert(response.razorpay_payment_id);
      alert(response.razorpay_order_id);
      alert(response.razorpay_signature)
     
      verifyPayment(response, order)
      },
      "prefill": {
      "name": "Gaurav Kumar",
      "email": "gaurav.kumar@example.com",
      "contact": "9999999999"
      },
      "notes": {
      "address": "Razorpay Corporate Office"
      },
      "theme": {
      "color": "#3399cc"
      }
      };
      var rzp1 = new Razorpay(options);
      rzp1.open();
   }
   function verifyPayment(payment, order)
   {
      $.ajax({
         url:'/verify-payment',
         data:
         {
            payment, order
         },
         method:'post'
      })
   }
})
</script>